# Nginx configuration for SiteGround Flask tile server
# This would typically go in your SiteGround hosting configuration

server {
    listen 80;
    server_name your-domain.com;
    
    root /path/to/tile-server;
    
    # Direct serving of tile files (high performance, bypass Flask)
    location /tiles/ {
        try_files $uri $uri/ =404;
        expires 1d;
        add_header Cache-Control "public, immutable";
        
        # Handle compressed SVG files
        location ~* \.svg\.gz$ {
            add_header Content-Encoding gzip;
            add_header Content-Type image/svg+xml;
        }
    }
    
    # Static files (CSS, JS, images)
    location /static/ {
        try_files $uri $uri/ =404;
        expires 1w;
        add_header Cache-Control "public";
    }
    
    # Flask application (admin, API)
    location / {
        include proxy_params;
        proxy_pass http://unix:/path/to/tile-server/tile-server.sock;
        
        # CORS headers for API
        add_header Access-Control-Allow-Origin "*" always;
        add_header Access-Control-Allow-Methods "GET, POST, OPTIONS" always;
        add_header Access-Control-Allow-Headers "Content-Type" always;
    }
    
    # Security headers
    add_header X-Content-Type-Options nosniff always;
    add_header X-Frame-Options DENY always;
    add_header X-XSS-Protection "1; mode=block" always;
    
    # Hide sensitive files
    location ~ /\. {
        deny all;
    }
    
    location ~ \.py$ {
        deny all;
    }
    
    location ~ /(data/logs|__pycache__|\.git)/ {
        deny all;
    }
}